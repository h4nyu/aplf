version: "2.4"

services:
  app:
    build:
      context: ./app
      args:
        - http_proxy
        - https_proxy
    runtime: nvidia
    volumes:
      - ./app:/srv
      - ./store:/store

  notebook:
    build:
      context: ./app
      args:
        - http_proxy
        - https_proxy
    runtime: nvidia
    command: pipenv run notebook
    volumes:
      - ./app:/srv
      - ./store:/store
    ports:
      - "${NOTEBOOK_PORT}:8888"

  web:
    build:
      context: ./web
    volumes:
      - ./web/nginx.conf:/etc/nginx/nginx.conf
      - ./store:/public
    ports:
      - "${WEB_PORT}:80"
